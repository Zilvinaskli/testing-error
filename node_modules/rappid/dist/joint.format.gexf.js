/*! Rappid v3.0.1 - HTML5 Diagramming Framework

Copyright (c) 2015 client IO

 2019-08-10 


This Source Code Form is subject to the terms of the Rappid License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/


this.joint = this.joint || {};
(function (exports) {
    'use strict';

    var toCellsArray = function(xmlString, makeElement, makeLink) {

        // Parse the `xmlString` into a DOM tree.
        var parser = new DOMParser();
        var dom = parser.parseFromString(xmlString, 'text/xml');
        if (dom.documentElement.nodeName == 'parsererror') {
            throw new Error('Error while parsing GEXF file.');
        }

        // Get all nodes and edges.
        var nodes = Array.from(dom.documentElement.querySelectorAll('node'));
        var edges = Array.from(dom.documentElement.querySelectorAll('edge'));

        // Return value.
        var cells = [];

        nodes.forEach(function(node) {

            var size = parseFloat(node.querySelector('size').getAttribute('value'));

            var element = makeElement({
                id: node.getAttribute('id'),
                width: size,
                height: size,
                label: node.getAttribute('label')
            });

            cells.push(element);
        });

        edges.forEach(function(edge) {

            var link = makeLink({ source: edge.getAttribute('source'), target: edge.getAttribute('target') });
            cells.unshift(link);
        });

        return cells;
    };

    exports.toCellsArray = toCellsArray;

}(this.joint.format = this.joint.format || {}));
